- name: Add .my.cnf
  template: src=my.cnf.j2 dest=/root/.my.cnf owner=root group=root mode=0600
- name: install mariadb
  pacman: name=mariadb state=present
  when: ansible_os_family == 'Archlinux'
- name: install mysql-python
  pacman: name=mysql-python state=present
  when: ansible_os_family == 'Archlinux'
- name: deploy my.conf
  copy:
    src: my.conf
    dest: /etc/mysql/my.cnf
- name: mariadb init
  become: yes
  command: 'mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql'
  args:
    creates: /var/lib/mysql/mysql-bin.index
- name: mariadb start
  service:
    name=mariadb state=started
- name: set rootpass
  mysql_user:
    login_user=root
    login_password={{ mariadbrootpassword }}
    login_port=3306
    host=localhost
    name=root
    password={{ mariadbrootpassword }}
    check_implicit_admin=yes
    state=present
    login_unix_socket=/run/mysqld/mysqld.sock
- name: Removes anonymous user account for localhost
  mysql_user:
    name: ''
    host: localhost
    state: absent
- name: Removes all anonymous user accounts
  mysql_user:
    name: ''
    host_all: yes
    state: absent
- name: Removes the MySQL test database
  mysql_db: db=test state=absent
